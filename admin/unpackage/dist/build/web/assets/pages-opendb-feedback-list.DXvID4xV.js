import{_ as e,e as t,n as a,r as n,a as l,c as i,w as s,i as o,b as r,d,f as c,g as u,o as f,h,k as g,l as p,m,F as b,I as _,p as y,t as C}from"./index-D1p2mCzQ.js";import{_ as x}from"./download-excel.Ck8rHhh9.js";import{_ as k}from"./uni-file-picker.CRS_ZhzO.js";import{_ as S}from"./uni-link.B8ACWWo2.js";import{_ as w}from"./uni-dateformat.DBKAIs-I.js";import{_ as D}from"./uni-pagination.xUXIXlYj.js";import{_ as $}from"./unicloud-db.iPsAcwdl.js";import{e as z,f as T}from"./opendb-feedback.BEZKan66.js";const j=t.database(),v=[],E={ascending:"asc",descending:"desc"};const I=e({data:()=>({collectionList:"opendb-feedback",query:"",where:"",orderby:"",orderByFieldName:"",selectedIndexs:[],options:{pageSize:20,pageCurrent:1,filterData:{},...z},imageStyles:{width:64,height:64},exportExcel:{filename:"opendb-feedback.xls",type:"xls",fields:{"留言内容/回复内容":"content","图片列表":"imgs","联系人":"contact","联系电话":"mobile","留言时间/回复留言时间":"create_date",user_id:"user_id"}},exportExcelData:[]}),onLoad(){this._filter={}},onReady(){this.$refs.udb.loadData()},methods:{onqueryload(e){this.exportExcelData=e},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return v.map((e=>t+".test("+e+")")).join(" || ")},search(){const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(e,t){a({url:e,events:{refreshData:()=>{this.loadData(t)}}})},selectedItems(){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t]._id))},delTable(){this.$refs.udb.remove(this.selectedItems(),{success:e=>{this.$refs.table.clearSelection()}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e,{success:e=>{this.$refs.table.clearSelection()}})},sortChange(e,t){this.orderByFieldName=t,e.order?this.orderby=t+" "+E[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,t){this._filter[t]={type:e.filterType,value:e.filter};let a=T(this._filter,j.command);Object.keys(a).length?this.where=a:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))}}},[["render",function(e,t,a,z,T,j){const v=o,E=_,I=y,F=n(l("download-excel"),x),L=n(l("uni-th"),r),V=n(l("uni-tr"),d),q=n(l("uni-td"),c),B=n(l("uni-file-picker"),k),U=n(l("uni-link"),S),N=n(l("uni-dateformat"),w),P=n(l("uni-table"),u),R=n(l("uni-pagination"),D),W=n(l("unicloud-db"),$);return f(),i(v,null,{default:s((()=>[h(v,{class:"uni-header"},{default:s((()=>[h(v,{class:"uni-group"},{default:s((()=>[h(v,{class:"uni-title"}),h(v,{class:"uni-sub-title"})])),_:1}),h(v,{class:"uni-group"},{default:s((()=>[h(E,{class:"uni-search",type:"text",modelValue:T.query,"onUpdate:modelValue":t[0]||(t[0]=e=>T.query=e),onConfirm:j.search,placeholder:"请输入搜索内容"},null,8,["modelValue","onConfirm"]),h(I,{class:"uni-button",type:"default",size:"mini",onClick:j.search},{default:s((()=>[g("搜索")])),_:1},8,["onClick"]),h(I,{class:"uni-button",type:"default",size:"mini",onClick:t[1]||(t[1]=e=>j.navigateTo("./add"))},{default:s((()=>[g("新增")])),_:1}),h(I,{class:"uni-button",type:"default",size:"mini",disabled:!T.selectedIndexs.length,onClick:j.delTable},{default:s((()=>[g("批量删除")])),_:1},8,["disabled","onClick"]),h(F,{class:"hide-on-phone",fields:T.exportExcel.fields,data:T.exportExcelData,type:T.exportExcel.type,name:T.exportExcel.filename},{default:s((()=>[h(I,{class:"uni-button",type:"primary",size:"mini"},{default:s((()=>[g("导出 Excel")])),_:1})])),_:1},8,["fields","data","type","name"])])),_:1})])),_:1}),h(v,{class:"uni-container"},{default:s((()=>[h(W,{ref:"udb",collection:T.collectionList,field:"content,imgs,contact,mobile,create_date,user_id",where:T.where,"page-data":"replace",orderby:T.orderby,getcount:!0,"page-size":T.options.pageSize,"page-current":T.options.pageCurrent,options:T.options,loadtime:"manual",onLoad:j.onqueryload},{default:s((({data:e,pagination:a,loading:n,error:l,options:o})=>[h(P,{ref:"table",loading:n,emptyText:l.message||"没有更多数据",border:"",stripe:"",type:"selection",onSelectionChange:j.selectionChange},{default:s((()=>[h(V,null,{default:s((()=>[h(L,{align:"center","filter-type":"search",onFilterChange:t[2]||(t[2]=e=>j.filterChange(e,"content")),sortable:"",onSortChange:t[3]||(t[3]=e=>j.sortChange(e,"content"))},{default:s((()=>[g("留言内容/回复内容")])),_:1}),h(L,{align:"center",sortable:"",onSortChange:t[4]||(t[4]=e=>j.sortChange(e,"imgs"))},{default:s((()=>[g("图片列表")])),_:1}),h(L,{align:"center","filter-type":"search",onFilterChange:t[5]||(t[5]=e=>j.filterChange(e,"contact")),sortable:"",onSortChange:t[6]||(t[6]=e=>j.sortChange(e,"contact"))},{default:s((()=>[g("联系人")])),_:1}),h(L,{align:"center","filter-type":"search",onFilterChange:t[7]||(t[7]=e=>j.filterChange(e,"mobile")),sortable:"",onSortChange:t[8]||(t[8]=e=>j.sortChange(e,"mobile"))},{default:s((()=>[g("联系电话")])),_:1}),h(L,{align:"center","filter-type":"timestamp",onFilterChange:t[9]||(t[9]=e=>j.filterChange(e,"create_date")),sortable:"",onSortChange:t[10]||(t[10]=e=>j.sortChange(e,"create_date"))},{default:s((()=>[g("留言时间/回复留言时间")])),_:1}),h(L,{align:"center",sortable:"",onSortChange:t[11]||(t[11]=e=>j.sortChange(e,"user_id"))},{default:s((()=>[g("user_id")])),_:1}),h(L,{align:"center"},{default:s((()=>[g("操作")])),_:1})])),_:1}),(f(!0),p(b,null,m(e,((e,t)=>(f(),i(V,{key:t},{default:s((()=>[h(q,{align:"center"},{default:s((()=>[g(C(e.content),1)])),_:2},1024),h(q,{align:"center"},{default:s((()=>[(f(!0),p(b,null,m(e.imgs,((e,t)=>(f(),p(b,null,["image"==e.fileType?(f(),i(B,{key:0,value:e,"file-mediatype":e.fileType,imageStyles:T.imageStyles,readonly:""},null,8,["value","file-mediatype","imageStyles"])):(f(),i(U,{key:1,href:e.url,text:e.url},null,8,["href","text"]))],64)))),256))])),_:2},1024),h(q,{align:"center"},{default:s((()=>[g(C(e.contact),1)])),_:2},1024),h(q,{align:"center"},{default:s((()=>[g(C(e.mobile),1)])),_:2},1024),h(q,{align:"center"},{default:s((()=>[h(N,{threshold:[0,0],date:e.create_date},null,8,["date"])])),_:2},1024),h(q,{align:"center"},{default:s((()=>[g(C(e.user_id),1)])),_:2},1024),h(q,{align:"center"},{default:s((()=>[h(v,{class:"uni-group"},{default:s((()=>[h(I,{onClick:t=>j.navigateTo("./edit?id="+e._id,!1),class:"uni-button",size:"mini",type:"primary"},{default:s((()=>[g("修改")])),_:2},1032,["onClick"]),h(I,{onClick:t=>j.confirmDelete(e._id),class:"uni-button",size:"mini",type:"warn"},{default:s((()=>[g("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText","onSelectionChange"]),h(v,{class:"uni-pagination-box"},{default:s((()=>[h(R,{"show-icon":"","page-size":a.size,modelValue:a.current,"onUpdate:modelValue":e=>a.current=e,total:a.count,onChange:j.onPageChanged},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange"])])),_:2},1024)])),_:1},8,["collection","where","orderby","page-size","page-current","options","onLoad"])])),_:1})])),_:1})}]]);export{I as default};

import{h as e,c as a,w as A,i as t,o as l,a as s,e as c,D as n,a2 as i,p as o,C as r,l as u,H as I,K as R,g as E}from"./index-BFSQzsUc.js";import{_ as m}from"./_plugin-vue_export-helper.BCo6x5W8.js";const d=m({__name:"auth",setup(m){const d=e(!1),G=async()=>{var e;if(!d.value){d.value=!0;try{const[a,A]=await n({title:"授权提示",content:"是否允许获取您的用户信息？"});if(a||!A.confirm)throw new Error("用户拒绝授权");const[t,l]=await i({provider:"weixin"});if(t)throw new Error("登录失败");const[s,c]=await uni.getUserProfile({desc:"用于完善用户资料",lang:"zh_CN"});if(s)throw new Error("获取用户信息失败");const[R,E]=await o.callFunction({name:"login",data:{code:l.code,userInfo:c.userInfo}});if(R||!E.result.success)throw new Error((null==(e=null==E?void 0:E.result)?void 0:e.message)||"服务器登录失败");r("userInfo",c.userInfo),E.result.token&&r("token",E.result.token),u({title:"登录成功",icon:"success"});getOpenerEventChannel().emit("loginSuccess",c.userInfo),setTimeout((()=>{I()}),1500)}catch(a){console.error("授权登录失败:",a),u({title:a.message||"授权登录失败",icon:"none"})}finally{d.value=!1}}},T=()=>{I()};return(e,n)=>{const i=R,o=t,r=E;return l(),a(o,{class:"auth-container"},{default:A((()=>[s(o,{class:"auth-card"},{default:A((()=>[s(i,{class:"logo",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABIBAMAAACnw650AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAMqaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzEzMiA3OS4xNTkyODQsIDIwMTYvMDQvMTktMTM6MTM6NDAgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkZGQTQyNzE1N0RDNjExRThCRkE4REM4RUJDRTQ1MEYxIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkZGQTQyNzE0N0RDNjExRThCRkE4REM4RUJDRTQ1MEYxIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1LjUgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCQThGQUI3QzdEQzUxMUU4QkZBOERDOEVCQ0U0NTBGMSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCQThGQUI3RDdEQzUxMUU4QkZBOERDOEVCQ0U0NTBGMSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PkFln7cAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAAAFVBMVEVHcEwqmTgqmTgqmTgqmTgqmTj////NZKseAAAABXRSTlMA9a0i6zIZU8cAAAB2SURBVEgNY2BWDCUAhAwYTAgoAUo7M6gSVhTEIEpYUSADYTWhoaOKRkoQhKWlpSGnCCA3FcaHp4JRRaGjQTAaBKGjQTAgQQAsk5AB9vIJWQWQPYwUwYpjbDS8iMYmCRMbVUTN2lwUFqy46UDimmtENfyIaUICAJYycVMAg+H5AAAAAElFTkSuQmCC",mode:"aspectFit"}),s(o,{class:"title"},{default:A((()=>[c("授权登录")])),_:1}),s(o,{class:"desc"},{default:A((()=>[c("请授权获取您的用户信息")])),_:1}),s(r,{class:"auth-btn",onClick:G,type:"primary"},{default:A((()=>[c(" 授权登录 ")])),_:1}),s(r,{class:"cancel-btn",onClick:T,type:"default"},{default:A((()=>[c(" 取消 ")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-4189e400"]]);export{d as default};
